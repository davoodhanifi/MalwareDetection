from FeatureExtract.extract import analyze
from Droidbox.droidbox import main as dbox
import sys
import os
import csv

def build_dataset(path, apps_type): 
    files = []
    path = os.getcwd() + path

    for parent, dirname, filenames in os.walk(path):
        for filename in filenames:
            extension = os.path.splitext(filename)[1]
        
            if extension == '.apk':
                files.append(os.path.join(parent, filename))
            
    total_features = []

    for filename in files:
        app_feature = None
        try:
            # get static features
            app_features = analyze(filename)

            # Add apps_type to first possition of each row
            app_features.insert(0, apps_type)

            # get dynamic features
            # dbo = dbox(filename)
            # app_features = dbox(filename, 2)
            # dynamicFeatures = dbox(filename, 20)
            # app_features += dynamicFeatures 

            # add features
            total_features.append(app_features)

        except Exception as e:
            print "Exception: ", str(e)

    csv_file = open('./Data/dataset.csv','a')
    writer = csv.writer(csv_file)

    for feature in total_features:
        writer.writerow(feature)
